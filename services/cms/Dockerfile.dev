# FROM drupal:php8.1-fpm-alpine3.16
# FROM drupal:9.5.3-php8.1-fpm-alpine3.16
# FROM drupal:9.5.7-php8.1-fpm-alpine3.17
FROM drupal:9.5.7-php8.1-apache-bullseye

ARG ROOT
ARG ENV

# Install build dependencies
# RUN apk add --no-cache bash
# RUN apk add --no-cache git
# RUN apk add --no-cache mysql-client
RUN apt-get update && apt-get install -y \
    default-mysql-client \
    && rm -rf /var/lib/apt/lists/*

# Install modules
RUN touch /.dockerenv
# RUN composer require drush/drush:^10.6.2
RUN composer require \
    drush/drush:^11.5.1 \
    drupal/admin_toolbar:^3.3.0 \
    drupal/backup_migrate:^5.0.3 \
    drupal/coder:^8.3.16 \
    drupal/coffee:^1.3 \
    drupal/devel:^5.1.1 \
    drupal/gin_toolbar:^1.0@RC \
    drupal/gin:^3.0@RC \
    drupal/pathauto:^1.11 \
    drupal/smtp:^1.2 \
    drupal/file_delete:^2.0 \
    drupal/content_type_clone:^1.0 \
    drupal/drush_language:^1.0@RC \
    drupal/taxonomy_multidelete_terms:^1.3 \
    drupal/realistic_dummy_content:^3.1 \
    drupal/easy_breadcrumb:^2.0 \
    drupal/language_switcher_extended:^1.1
    # ccampbell/chromephp:^4.1

# Copy project files from host
COPY $ROOT/drupal.sh ./
# COPY $ROOT/docker-php-entrypoint /usr/local/bin/
# RUN chmod +x /usr/local/bin/docker-php-entrypoint
COPY $ROOT/src/.htaccess ./web/
COPY $ROOT/src/robots.txt ./web/
COPY $ROOT/config/php.ini-$ENV /usr/local/etc/php/php.ini

# TODO: run drupal.sh --install
# CMD ["sh", "-c", "drupal.sh --install"]
# CMD ["bash /opt/drupal/drupal.sh --install"]
# CMD ["pwd && ls -la"]
# ENTRYPOINT ["pwd"]
# ENTRYPOINT ["bash /opt/drupal/drupal.sh --install"]
# ENTRYPOINT ["bash /usr/local/bin/docker-php-entrypoint && cd /opt/drupal && bash drupal.sh --install"]
# ENTRYPOINT ["docker-php-entrypoint"]
